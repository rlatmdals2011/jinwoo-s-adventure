<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‘ì€ë‚¨ì í­ì£¼ì „ (3íšŒ ê³µê²© + 1ì´ˆ ì§€ì†)</title>
<style>
body {
  margin: 0;
  background: black;
  color: white;
  overflow: hidden;
  font-family: "Courier New", monospace;
}
#battle-box {
  position: absolute;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  width: 600px;
  height: 250px;
  border: 3px solid white;
  background: #111;
  overflow: hidden;
}
#jinwoo {
  position: absolute;
  bottom: 40px;
  left: 280px;
  width: 45px;
  height: 45px;
  border-radius: 50%;
  background: #00aaff;
  box-shadow: 0 0 12px #00ffff;
  transition: opacity 0.1s;
}
#boss {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 160px;
  height: auto;
  border-radius: 8px;
  box-shadow: 0 0 25px rgba(255,255,255,0.9);
  animation: flicker 0.2s infinite alternate;
  transition: filter 2s ease-in-out;
}
@keyframes flicker {
  0% { filter: brightness(1); }
  100% { filter: brightness(3); }
}
.warning-line {
  position: absolute;
  background: rgba(255,0,0,0.3);
  opacity: 0;
  transition: opacity 0.3s;
}
.laser {
  position: absolute;
  background: linear-gradient(to right, white, #aaffff);
  box-shadow: 0 0 35px white;
}
#hp, #boss-hp {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  font-size: 1.3rem;
  font-weight: bold;
}
#hp { bottom: 370px; color: #ff5555; }
#boss-hp { top: 10px; color: #ffaa00; }
#dialogue {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 600px;
  height: 80px;
  background: #111;
  border: 3px solid white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
}
#damage-flash {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(255, 0, 0, 0.4);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
}
#damage-text {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 2rem;
  font-weight: bold;
  color: #ff3333;
  opacity: 0;
  transition: opacity 0.3s, transform 0.3s;
  pointer-events: none;
}
#attack-btn {
  position: absolute;
  bottom: 130px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 24px;
  background: #ff4040;
  border: 3px solid white;
  color: white;
  border-radius: 10px;
  font-size: 1.2rem;
  cursor: pointer;
  display: none;
  transition: 0.2s;
}
#attack-btn:hover { background: white; color: #ff4040; }
#rage-text {
  position: fixed;
  top: 45%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 2rem;
  color: red;
  font-weight: bold;
  opacity: 0;
  transition: opacity 0.3s;
  text-shadow: 0 0 20px red;
}
</style>
</head>
<body>
<div id="battle-box">
  <div id="jinwoo"></div>
</div>
<img id="boss" src="smallman.jpg" alt="í‚¤ì‘ì€ë‚¨ì í­ì£¼í¼">
<div id="boss-hp">ë³´ìŠ¤ HP: 600</div>
<div id="hp"></div>
<div id="dialogue">ì‘ì€ë‚¨ì: ë¹›ì˜ ì‹­ìê°€! í”¼í•  ìˆ˜ ìˆê² ì–´?</div>
<div id="damage-flash"></div>
<div id="damage-text">ğŸ’” ì²´ë ¥ -1</div>
<div id="rage-text"></div>
<button id="attack-btn">âš” ë°˜ê²©!</button>

<script>
const battleBox = document.getElementById("battle-box");
const jinwoo = document.getElementById("jinwoo");
const dialogue = document.getElementById("dialogue");
const hpDisplay = document.getElementById("hp");
const bossHpDisplay = document.getElementById("boss-hp");
const flash = document.getElementById("damage-flash");
const dmgText = document.getElementById("damage-text");
const attackBtn = document.getElementById("attack-btn");
const rageText = document.getElementById("rage-text");
const bossImg = document.getElementById("boss");

let jinwooHp = 3;
let bossHp = 600;
let attackCount = 0;
let invincible = false;

updateHp();

function updateHp() {
  hpDisplay.textContent = `â¤ï¸ x${jinwooHp}`;
  bossHpDisplay.textContent = `ë³´ìŠ¤ HP: ${bossHp}`;
}

// âš¡ ì‹­ìê°€ ê³µê²©
function fireCrossLaser() {
  const jRect = jinwoo.getBoundingClientRect();
  const boxRect = battleBox.getBoundingClientRect();
  const relX = jRect.left - boxRect.left + jRect.width / 2;
  const relY = parseFloat(jinwoo.style.bottom) + 22;

  // ê²½ê³ ì„ 
  const warnH = document.createElement("div");
  warnH.className = "warning-line";
  warnH.style.left = "0";
  warnH.style.width = "100%";
  warnH.style.height = "20px";
  warnH.style.bottom = relY + "px";

  const warnV = document.createElement("div");
  warnV.className = "warning-line";
  warnV.style.top = "0";
  warnV.style.height = "100%";
  warnV.style.width = "20px";
  warnV.style.left = relX + "px";

  battleBox.appendChild(warnH);
  battleBox.appendChild(warnV);
  warnH.style.opacity = "1";
  warnV.style.opacity = "1";

  setTimeout(() => {
    warnH.remove();
    warnV.remove();

    const laserH = document.createElement("div");
    laserH.className = "laser";
    laserH.style.left = "0";
    laserH.style.width = "100%";
    laserH.style.height = "20px";
    laserH.style.bottom = relY + "px";

    const laserV = document.createElement("div");
    laserV.className = "laser";
    laserV.style.top = "0";
    laserV.style.height = "100%";
    laserV.style.width = "20px";
    laserV.style.left = relX + "px";

    battleBox.appendChild(laserH);
    battleBox.appendChild(laserV);

    // ì¶©ëŒ ê°ì§€ (1ì´ˆ ìœ ì§€)
    const checkHit = setInterval(() => {
      const j = jinwoo.getBoundingClientRect();
      const h = laserH.getBoundingClientRect();
      const v = laserV.getBoundingClientRect();
      if (
        (h.bottom > j.top && h.top < j.bottom && h.right > j.left && h.left < j.right) ||
        (v.bottom > j.top && v.top < j.bottom && v.right > j.left && v.left < j.right)
      ) {
        hitJinwoo();
      }
    }, 50);

    setTimeout(() => {
      laserH.remove();
      laserV.remove();
      clearInterval(checkHit);
    }, 1000); // ğŸ”¥ ì§€ì†ì‹œê°„ 1ì´ˆ
  }, 800);

  attackCount++;
  if (attackCount >= 3) { // ğŸ’¥ 3íšŒ í›„ ë°˜ê²©
    attackCount = 0;
    setTimeout(() => {
      dialogue.textContent = "ì§€ê¸ˆì´ë‹¤! ë°˜ê²©í•´!";
      attackBtn.style.display = "block";
    }, 800);
  } else {
    setTimeout(() => {
      if (jinwooHp > 0) fireCrossLaser();
    }, 800);
  }
}

// â¤ï¸ í”¼ê²© (ë¬´ì  + ê¹œë¹¡)
function hitJinwoo() {
  if (invincible) return;
  jinwooHp--;
  updateHp();
  invincible = true;

  let blinkCount = 0;
  const blink = setInterval(() => {
    jinwoo.style.opacity = jinwoo.style.opacity === "0.3" ? "1" : "0.3";
    blinkCount++;
    if (blinkCount > 10) {
      clearInterval(blink);
      jinwoo.style.opacity = "1";
    }
  }, 100);

  setTimeout(() => (invincible = false), 1000);

  flash.style.opacity = "1";
  setTimeout(() => (flash.style.opacity = "0"), 200);
  dmgText.style.opacity = "1";
  setTimeout(() => (dmgText.style.opacity = "0"), 800);
  dialogue.textContent = "ì§„ìš°ê°€ ë¹›ì˜ ì‹­ìê°€ì— ë§ì•˜ë‹¤!";
  if (jinwooHp <= 0) {
    dialogue.textContent = "ì§„ìš°ëŠ” ì“°ëŸ¬ì¡Œë‹¤...";
    setTimeout(() => window.location.href = "board.html", 2000);
  }
}

// âš” ë°˜ê²©
attackBtn.addEventListener("click", () => {
  attackBtn.style.display = "none";
  const damage = 100;
  bossHp -= damage;
  updateHp();
  dialogue.textContent = `ì§„ìš°ì˜ ë°˜ê²©! ğŸ’¥ (-${damage})`;

  if (bossHp <= 0) bossDefeated();
  else setTimeout(() => fireCrossLaser(), 1000);
});

// ğŸ’€ ë³´ìŠ¤ íŒ¨ë°°
function bossDefeated() {
  dialogue.textContent = "";
  bossImg.style.animation = "none";
  bossImg.style.filter = "brightness(0)";
  rageText.style.opacity = 1;
  rageText.textContent = "ë‹ˆê°€ ì´ê¸´ê±´... í‚¤ë¹¨ì´ì•¼!!!!!!!!!!";
  setTimeout(() => window.location.href = "jinwo19.html", 3000);
}

// ğŸ§­ ì§„ìš° ì´ë™
let x = 280, y = 40;
const moveSpeed = 15;
let keys = {};

window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

function moveJinwoo() {
  if (keys["w"]) y += moveSpeed * 0.8;
  if (keys["s"]) y -= moveSpeed * 0.8;
  if (keys["a"]) x -= moveSpeed;
  if (keys["d"]) x += moveSpeed;
  x = Math.max(0, Math.min(560, x));
  y = Math.max(0, Math.min(190, y));
  jinwoo.style.left = x + "px";
  jinwoo.style.bottom = y + "px";
  requestAnimationFrame(moveJinwoo);
}
moveJinwoo();
fireCrossLaser();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>í‚¤ì‘ì€ ë‚¨ì ë³´ìŠ¤ì „</title>
<style>
body {
  margin: 0;
  background: black;
  color: white;
  overflow: hidden;
  font-family: "Courier New", monospace;
}
#battle-box {
  position: absolute;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  width: 600px;
  height: 250px;
  border: 3px solid white;
  background: #111;
  overflow: hidden;
}
#jinwoo {
  position: absolute;
  bottom: 40px;
  left: 280px;
  width: 45px;
  height: 45px;
  border-radius: 50%;
  background: #00aaff;
  box-shadow: 0 0 10px #00aaff;
}
#boss {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 120px;
  height: auto;
  border-radius: 8px;
  box-shadow: 0 0 20px rgba(255, 50, 50, 0.8);
  transition: filter 0.1s;
}
.warning-line {
  position: absolute;
  left: 0;
  width: 100%;
  height: 8px;
  background: rgba(255, 0, 0, 0.8);
  box-shadow: 0 0 15px red;
  opacity: 0;
  transition: opacity 0.2s;
}
.attack {
  position: absolute;
  width: 60px;
  height: 60px;
  background-image: url("6830.jpg");
  background-size: cover;
  background-position: center;
  box-shadow: 0 0 25px red;
  border-radius: 10px;
}
#hp, #boss-hp {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  font-size: 1.3rem;
  font-weight: bold;
}
#hp { bottom: 370px; color: #ff5555; }
#boss-hp { top: 10px; color: #ffaa00; }
#dialogue {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 600px;
  height: 80px;
  background: #111;
  border: 3px solid white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
}
#damage-flash {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(255, 0, 0, 0.4);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
}
#damage-text {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 2rem;
  font-weight: bold;
  color: #ff3333;
  opacity: 0;
  transition: opacity 0.3s, transform 0.3s;
  pointer-events: none;
}
#attack-btn {
  position: absolute;
  bottom: 130px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 24px;
  background: #ff4040;
  border: 3px solid white;
  color: white;
  border-radius: 10px;
  font-size: 1.2rem;
  cursor: pointer;
  display: none;
  transition: 0.2s;
}
#attack-btn:hover { background: white; color: #ff4040; }
#rage-text {
  position: fixed;
  top: 45%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 2rem;
  color: red;
  font-weight: bold;
  opacity: 0;
  transition: opacity 0.3s;
  text-shadow: 0 0 20px red;
}
</style>
</head>
<body>
<div id="battle-box">
  <div id="jinwoo"></div>
</div>
<img id="boss" src="smallman.jpg" alt="í‚¤ì‘ì€ë‚¨ì">
<div id="boss-hp">ë³´ìŠ¤ HP: 1200</div>
<div id="hp"></div>
<div id="dialogue">ì‘ì€ë‚¨ì: ë”°ë¦‰ë”°ë¦‰~!</div>
<div id="damage-flash"></div>
<div id="damage-text">ğŸ’” ì²´ë ¥ -1</div>
<div id="rage-text">ë„Œ ë‚´ê°€ ë´ì¤€ ê±°ë‹¤... ë³´ì—¬ì£¼ë§ˆ ì‘ì€ë†ˆì˜ í˜ì„!!!</div>
<button id="attack-btn">âš” ê³µê²©</button>

<script>
const battleBox = document.getElementById("battle-box");
const jinwoo = document.getElementById("jinwoo");
const dialogue = document.getElementById("dialogue");
const hpDisplay = document.getElementById("hp");
const bossHpDisplay = document.getElementById("boss-hp");
const flash = document.getElementById("damage-flash");
const dmgText = document.getElementById("damage-text");
const attackBtn = document.getElementById("attack-btn");
const bossImg = document.getElementById("boss");
const rageText = document.getElementById("rage-text");

let bossHp = 1200;
let attackCount = 0;

// ğŸ”¹ ì§ì—… ë¶ˆëŸ¬ì˜¤ê¸°
let job = localStorage.getItem("jinwooJob") || "ë³µì„œ";
let jinwooHp = 3;
let jinwooAtk = 100;

if (job === "ìƒŒë“œë°±") {
  jinwooHp = 10;
  jinwooAtk = 50;
} else if (job === "ë„¤í¬ë¡œë§¨ì„œ") {
  jinwooHp = 8;
  jinwooAtk = 100;
}

updateHp();

// â¤ï¸ ì²´ë ¥ í‘œì‹œ
function updateHp() {
  hpDisplay.textContent = `â¤ï¸ x${jinwooHp}`;
  bossHpDisplay.textContent = "ë³´ìŠ¤ HP: " + bossHp;
}

// âš ï¸ ê²½ê³ ì„  + 1ì´ˆ í›„ ìì „ê±° ë°œì‚¬
function warnAndAttack() {
  const yPos = Math.random() * 180 + 20;

  const line = document.createElement("div");
  line.className = "warning-line";
  line.style.bottom = yPos + "px";
  battleBox.appendChild(line);
  line.style.opacity = "1";

  dialogue.textContent = "ì‘ì€ë‚¨ì: ë”°ë¦‰ë”°ë¦‰~ ê²½ê³ ì•¼!";

  setTimeout(() => {
    line.style.opacity = "0";
    shootBicycle(yPos);
    setTimeout(() => line.remove(), 500);
  }, 1000);
}

// ğŸš´ ìì „ê±° 1ê°œ ë°œì‚¬
function shootBicycle(yPos) {
  dialogue.textContent = "ì‘ì€ë‚¨ì: ë”°ë¦‰ë”°ë¦‰!!! ğŸš´â€â™‚ï¸";

  let baseSpeed = 8 + (1200 - bossHp) / 150;
  const attack = document.createElement("div");
  attack.className = "attack";
  attack.style.left = "580px";
  attack.style.bottom = yPos + "px";
  battleBox.appendChild(attack);

  function moveAttack() {
    let x = parseFloat(attack.style.left);
    x -= baseSpeed;
    attack.style.left = x + "px";

    const aRect = attack.getBoundingClientRect();
    const jRect = jinwoo.getBoundingClientRect();

    if (
      aRect.right > jRect.left &&
      aRect.left < jRect.right &&
      aRect.bottom > jRect.top &&
      aRect.top < jRect.bottom
    ) {
      attack.remove();
      hitJinwoo();
      return;
    }

    if (x < -80) {
      attack.remove();
      return;
    }

    requestAnimationFrame(moveAttack);
  }

  requestAnimationFrame(moveAttack);

  attackCount++;
  if (attackCount >= 3) {
    attackCount = 0;
    setTimeout(() => {
      dialogue.textContent = "ê³µê²©í•  ê¸°íšŒë‹¤!";
      attackBtn.style.display = "block";
    }, 1000);
  } else {
    setTimeout(() => {
      warnAndAttack();
    }, 1000);
  }
}

// â¤ï¸ ë§ì•˜ì„ ë•Œ
function hitJinwoo() {
  jinwooHp--;
  updateHp();
  dialogue.textContent = "ì§„ìš°ê°€ ë”°ë¦‰ë”°ë¦‰ì— ë§ì•˜ë‹¤! ğŸ’¥";

  flash.style.opacity = "1";
  setTimeout(() => (flash.style.opacity = "0"), 200);

  dmgText.style.opacity = "1";
  dmgText.style.transform = "translate(-50%, -60%) scale(1.1)";
  setTimeout(() => {
    dmgText.style.opacity = "0";
    dmgText.style.transform = "translate(-50%, -50%) scale(1)";
  }, 800);

  if (jinwooHp <= 0) {
    dialogue.textContent = "ì§„ìš°ëŠ” ì“°ëŸ¬ì¡Œë‹¤...";
    setTimeout(() => {
      window.location.href = "jinwodeath.html";
    }, 2500);
  }
}

// âš” ê³µê²© ë²„íŠ¼ ì´ë²¤íŠ¸
attackBtn.addEventListener("click", () => {
  attackBtn.style.display = "none";
  bossHp -= jinwooAtk;
  updateHp();
  dialogue.textContent = `ì§„ìš°ì˜ ë°˜ê²©! ğŸ’¥ (-${jinwooAtk})`;

  if (bossHp <= 0) {
    bossDefeated();
  } else {
    setTimeout(() => {
      dialogue.textContent = "ì‘ì€ë‚¨ì: ë‹¤ì‹œ ê°„ë‹¤!";
      warnAndAttack();
    }, 1000);
  }
});

// ğŸ’¥ ë³´ìŠ¤ íŒ¨ë°° ì—°ì¶œ
function bossDefeated() {
  dialogue.textContent = "";
  let flicker = true;

  const flickerInterval = setInterval(() => {
    bossImg.style.filter = flicker ? "brightness(3) hue-rotate(0deg)" : "brightness(0.2)";
    flicker = !flicker;
  }, 150);

  rageText.style.opacity = "1";
  rageText.textContent = "ë„Œ ë‚´ê°€ ë´ì¤€ ê±°ë‹¤... ë³´ì—¬ì£¼ë§ˆ ì‘ì€ë†ˆì˜ í˜ì„!!!";

  setTimeout(() => {
    clearInterval(flickerInterval);
    window.location.href = "jinwo18.html";
  }, 3000);
}

// ğŸ§­ ì§„ìš° ì´ë™
let x = 280, y = 40;
const moveSpeed = 10;
window.addEventListener("keydown", (e) => {
  e.preventDefault();
  switch (e.key.toLowerCase()) {
    case "w": y += moveSpeed; break;
    case "s": y -= moveSpeed; break;
    case "a": x -= moveSpeed; break;
    case "d": x += moveSpeed; break;
  }
  x = Math.max(0, Math.min(560, x));
  y = Math.max(0, Math.min(190, y));
  jinwoo.style.left = x + "px";
  jinwoo.style.bottom = y + "px";
});

warnAndAttack();
</script>
</body>
</html>

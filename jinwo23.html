<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÏßÑÏö∞ vs ÎèôÌúò (Í∂ÅÍ∑πÍ∏∞ Î≤ÑÏ†Ñ)</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: radial-gradient(circle at center, #000010 10%, #100020 80%);
  font-family: "Press Start 2P", cursive;
  color: white;
}

/* ===== ÏÉÅÎã® UI ===== */
#bossArea { text-align: center; margin-top: 10px; }
#boss {
  width: 120px; border-radius: 10px; box-shadow: 0 0 25px red;
}
#bossHP { color: orange; font-size: 1rem; margin-top: 5px; }

/* ===== Ï†ÑÌà¨ Î∞ïÏä§ ===== */
#battleBox {
  position: absolute; top: 50%; left: 50%;
  width: 600px; height: 350px;
  transform: translate(-50%, -50%);
  border: 2px solid white;
  background: rgba(0, 0, 30, 0.8);
  overflow: visible; box-shadow: 0 0 30px cyan;
}

/* ===== ÏßÑÏö∞ ===== */
#jinwoo {
  position: absolute;
  width: 40px; height: 40px; border-radius: 50%;
  background: radial-gradient(circle, #00ccff, #0044ff);
  box-shadow: 0 0 20px #00ffff;
  top: 150px; left: 280px;
  transition: 0.05s;
}

/* ===== Í≥µÍ≤© ===== */
.attack {
  position: absolute; width: 60px; height: 60px;
  background: radial-gradient(circle, #ff5555, #aa0000);
  box-shadow: 0 0 25px red; border-radius: 50%;
  opacity: 0.9; z-index: 10;
}
.ddoong {
  width: 65px; height: 65px;
  background: linear-gradient(45deg, #ff2222, #aa0000);
  border-radius: 8px; box-shadow: 0 0 35px #ff2222;
}

/* ===== Íµ¨Ï≤¥ ===== */
.orb {
  position: absolute; width: 30px; height: 30px;
  border-radius: 50%; box-shadow: 0 0 15px; z-index: 5;
}
.green { background: radial-gradient(circle, #00ff99, #008844); box-shadow: 0 0 25px #00ff99; }
.yellow { background: radial-gradient(circle, #ffff66, #ffaa00); box-shadow: 0 0 25px #ffcc00; }

/* ===== ÌïòÎã® UI ===== */
#controlBox {
  position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
  width: 400px; height: 160px;
  border: 2px solid white; background: #111;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
#attackBtn {
  background: #ff3333; color: white; border: none;
  padding: 10px 25px; border-radius: 8px;
  font-family: inherit; cursor: pointer;
  font-size: 1rem; box-shadow: 0 0 10px red;
  display: none; margin-top: 15px;
}
#msg { color: #ccc; font-size: 0.9rem; }
#hearts { text-align: center; margin-top: 10px; font-size: 1.3rem; color: #ff6666; }

/* ===== ÌîºÍ≤© ===== */
.flash {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(255,0,0,0.4); opacity: 0;
  pointer-events: none; transition: opacity 0.2s;
}

/* ===== Î¨¥Ï†Å ===== */
.invincible { animation: blink 0.4s infinite alternate; }
@keyframes blink { from{opacity:1;} to{opacity:0.4;} }

/* ===== Í∂ÅÍ∑πÍ∏∞ Ïª∑Ïî¨ ===== */
#cutscene {
  position: fixed; top:0; left:0; width:100%; height:100%;
  background:black; opacity:0; pointer-events:none;
  display:flex; justify-content:center; align-items:center;
  color:white; font-size:1.5rem; text-shadow:0 0 20px cyan;
  transition: opacity 1s;
}
</style>
</head>
<body>

<div id="bossArea">
  <img id="boss" src="imboss.jpg" alt="ÎèôÌúò">
  <div id="bossHP">Î≥¥Ïä§ HP: 2000</div>
</div>

<div id="battleBox">
  <div id="jinwoo"></div>
</div>

<div id="hearts"></div>

<div id="controlBox">
  <div id="msg">Ï†ÑÌà¨ ÏãúÏûë!</div>
  <button id="attackBtn">‚úñ Í≥µÍ≤©</button>
</div>

<div class="flash" id="flash"></div>
<div id="cutscene"></div>

<script>
/* ===== ÏßÅÏóÖÎ≥Ñ Îä•Î†•Ïπò ===== */
const jobStats = {
  "Î≥µÏÑú": { hp: 3, atk: 100 },
  "ÏßÑÌôîÌïúÏÉåÎìúÎ∞±": { hp: 10, atk: 50 },
  "ÎÑ§ÌÅ¨Î°úÎß®ÏÑú": { hp: 8, atk: 100 },
  "ÏäàÌçºÏßÑÏö∞": { hp: 15, atk: 150 },
  "Í∞ÅÏÑ±ÏßÑÏö∞": { hp: 20, atk: 200 }
};

/* ===== Î≥ÄÏàò ===== */
let job = localStorage.getItem("jinwooJob") || "ÏäàÌçºÏßÑÏö∞";
let jinwooHP = jobStats[job].hp;
let atkPower = jobStats[job].atk;
let bossHP = 2000;
let invincible = false;
let paused = false;
let turn = "boss";
let jinwooX = 280, jinwooY = 150;
let keys = {};
const speed = 3.5;
const box = document.getElementById("battleBox");
const jinwoo = document.getElementById("jinwoo");
const msg = document.getElementById("msg");
const bossHPtxt = document.getElementById("bossHP");
const hearts = document.getElementById("hearts");
const attackBtn = document.getElementById("attackBtn");
const flash = document.getElementById("flash");
const cutscene = document.getElementById("cutscene");

/* ===== Ï¥àÍ∏∞ ===== */
updateUI();
msg.textContent = `ÌòÑÏû¨ ÏßÅÏóÖ: ${job} (‚ù§Ô∏è${jinwooHP}, ‚öîÔ∏è${atkPower})`;
setTimeout(startBossTurn, 3000);
spawnOrbs();

/* ===== Ïù¥Îèô ===== */
document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

function moveLoop(){
  if (!paused && turn === "boss"){
    if (keys["w"]) jinwooY -= speed;
    if (keys["s"]) jinwooY += speed;
    if (keys["a"]) jinwooX -= speed;
    if (keys["d"]) jinwooX += speed;
    jinwooX = Math.max(0, Math.min(560, jinwooX));
    jinwooY = Math.max(0, Math.min(310, jinwooY));
    jinwoo.style.left = jinwooX + "px";
    jinwoo.style.top = jinwooY + "px";
  }
  if (!paused) checkOrbCollisions();
  requestAnimationFrame(moveLoop);
}
moveLoop();

/* ===== Íµ¨Ï≤¥ Ïä§Ìè∞ ===== */
function spawnOrbs(){
  setInterval(()=>{
    if (paused) return;
    const r = Math.random();
    let type = "green";
    if (r < 0.01) type = "yellow"; // 1% ÌôïÎ•†
    createOrb(type);
  }, 4000);
}

function createOrb(type){
  const orb = document.createElement("div");
  orb.className = `orb ${type}`;
  orb.style.left = Math.random()*560 + "px";
  orb.style.top = Math.random()*300 + "px";
  box.appendChild(orb);
  setTimeout(()=>orb.remove(), 7000);
}

/* ===== Íµ¨Ï≤¥ Ï∂©Îèå ===== */
function checkOrbCollisions(){
  const orbs = document.querySelectorAll(".orb");
  orbs.forEach(orb=>{
    if (collide(jinwoo, orb)){
      if (orb.classList.contains("green")){
        jinwooHP++;
        updateUI();
        orb.remove();
      } else if (orb.classList.contains("yellow")){
        orb.remove();
        ultimateCutscene();
      }
    }
  });
}

/* ===== Í∂ÅÍ∑πÍ∏∞ Ïª∑Ïî¨ ===== */
function ultimateCutscene(){
  paused = true;
  cutscene.style.opacity = 1;
  cutscene.style.pointerEvents = "auto";
  cutscene.textContent = "‚ö° ÏßÑÏö∞Ïùò Í∂ÅÍ∑πÍ∏∞ Î∞úÎèô ‚ö°";
  jinwoo.style.boxShadow = "0 0 100px #ffff66";
  setTimeout(()=>{
    cutscene.textContent = "ÎπõÏù¥ Ìè≠Î∞úÌïúÎã§...";
  }, 1500);
  setTimeout(()=>{
    cutscene.style.opacity = 0;
    paused = false;
    bossHP -= 300;
    msg.textContent = "Í∂ÅÍ∑πÍ∏∞! üí• 300 Îç∞ÎØ∏ÏßÄ!";
    updateUI();
    if (bossHP <= 0) {
      msg.textContent = "ÎèôÌúò: ...Ïù¥Îü¥ÏàòÍ∞Ä...";
      setTimeout(()=>window.location.href="jinwo24.html",2500);
    }
  }, 3500);
}

/* ===== UI ===== */
function updateUI(){
  bossHPtxt.textContent = `Î≥¥Ïä§ HP: ${bossHP}`;
  hearts.innerHTML = "‚ù§Ô∏è".repeat(jinwooHP);
}

/* ===== Î≥¥Ïä§ Í≥µÍ≤© ===== */
function startBossTurn(){
  turn = "boss";
  msg.textContent = "ÎèôÌúòÏùò Í≥µÍ≤©!";
  attackBtn.style.display = "none";
  const pattern = Math.random() < 0.5 ? 1 : 2;
  if (pattern === 1) pattern_Ddoong();
  else pattern_MultiRed();
}

/* ===== Í≥µÍ≤©Ìå®ÌÑ¥ ===== */
function pattern_Ddoong(){
  if (paused) return;
  const boxRect = box.getBoundingClientRect();
  for (let i=0;i<5;i++){
    setTimeout(()=>{
      const atk = document.createElement("div");
      atk.className = "attack ddoong";
      atk.style.left = (boxRect.left - 100) + "px";
      atk.style.top = (boxRect.top + Math.random()*300) + "px";
      document.body.appendChild(atk);
      let x = boxRect.left - 100;
      const move = setInterval(()=>{
        if (paused) return;
        x += 12;
        atk.style.left = x + "px";
        if (collide(jinwoo, atk) && !invincible){
          hitPlayer();
          atk.remove();
          clearInterval(move);
        }
        if (x > boxRect.right + 100){
          atk.remove();
          clearInterval(move);
        }
      },40);
    }, i*400);
  }
  setTimeout(nextTurn, 3000);
}

function pattern_MultiRed(){
  if (paused) return;
  const boxRect = box.getBoundingClientRect();
  for (let i=0;i<15;i++){
    setTimeout(()=>{
      const atk = document.createElement("div");
      atk.className = "attack";
      atk.style.left = (boxRect.left + Math.random()*550) + "px";
      atk.style.top = (boxRect.top - 80) + "px";
      document.body.appendChild(atk);
      let y = boxRect.top - 80;
      const fall = setInterval(()=>{
        if (paused) return;
        y += 8;
        atk.style.top = y + "px";
        if (collide(jinwoo, atk) && !invincible){
          hitPlayer();
          atk.remove();
          clearInterval(fall);
        }
        if (y > boxRect.bottom + 50){
          atk.remove();
          clearInterval(fall);
        }
      },40);
    }, i*200);
  }
  setTimeout(nextTurn, 4000);
}

/* ===== ÌîºÍ≤© ===== */
function hitPlayer(){
  if (invincible || paused) return;
  jinwooHP--;
  updateUI();
  flash.style.opacity = 1;
  setTimeout(()=>flash.style.opacity=0,200);
  if (jinwooHP <= 0){
    msg.textContent = "ÏßÑÏö∞Îäî Ï°åÎã§...";
    setTimeout(()=>window.location.href="board.html",2500);
  }
}

/* ===== ÌÑ¥ Ï†ÑÌôò ===== */
function nextTurn(){
  if (jinwooHP>0 && bossHP>0){
    msg.textContent = "Í≥µÍ≤©Ìï† Í∏∞ÌöåÎã§!";
    attackBtn.style.display = "block";
    turn = "player";
  }
}

/* ===== Í≥µÍ≤© Î≤ÑÌäº ===== */
attackBtn.addEventListener("click", ()=>{
  if (turn!=="player") return;
  attackBtn.style.display = "none";
  msg.textContent = `${job}Ïùò Í≥µÍ≤©!`;
  bossHP -= atkPower;
  updateUI();
  if (bossHP<=0){
    msg.textContent = "ÎèôÌúò: ...Ïù¥Îü¥ÏàòÍ∞Ä...";
    setTimeout(()=>window.location.href="jinwo24.html",2500);
  } else {
    setTimeout(startBossTurn,1500);
  }
});

/* ===== Ï∂©Îèå ===== */
function collide(a,b){
  const r1 = a.getBoundingClientRect();
  const r2 = b.getBoundingClientRect();
  return !(r1.right<r2.left||r1.left>r2.right||r1.bottom<r2.top||r1.top>r2.bottom);
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì§„ìš° vs ë™íœ˜ : ìµœì¢…ì „</title>
<style>
/* ===== ê¸°ë³¸ ìŠ¤íƒ€ì¼ ===== */
body {
  margin: 0;
  overflow: hidden;
  font-family: "Press Start 2P", cursive;
  color: white;
  background: radial-gradient(circle at center, #000010 20%, #0b0015 80%);
}

/* ===== ìš°ì£¼ ë°°ê²½ + ë³„ ì›€ì§ì„ ===== */
body::before {
  content: "";
  position: fixed;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.2) 1px, transparent 1px);
  background-size: 3px 3px;
  top: 0;
  left: 0;
  animation: starMove 100s linear infinite;
  z-index: 0;
  opacity: 0.4;
}
@keyframes starMove {
  from { transform: translate(0, 0); }
  to { transform: translate(-500px, -500px); }
}

/* ===== ë³´ìŠ¤ ì´ë¯¸ì§€ ===== */
#bossArea {
  text-align: center;
  margin-top: 15px;
}
#boss {
  width: 120px;
  border-radius: 10px;
  box-shadow: 0 0 40px red;
}
#bossHP {
  color: orange;
  font-size: 1rem;
  margin-top: 5px;
}

/* ===== ì „íˆ¬ë°•ìŠ¤ ===== */
#battleBox {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 650px;
  height: 380px;
  transform: translate(-50%, -50%);
  border: 2px solid white;
  background: rgba(10, 10, 30, 0.7);
  box-shadow: 0 0 25px cyan;
  overflow: hidden;
  z-index: 2;
}

/* ===== ì§„ìš° ===== */
#jinwoo {
  position: absolute;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: radial-gradient(circle, #00ccff, #0044ff);
  box-shadow: 0 0 25px #00ffff;
  top: 150px;
  left: 300px;
  transition: 0.05s;
  z-index: 5;
}

/* ===== ê³µê²© ===== */
.attack {
  position: absolute;
  width: 55px;
  height: 55px;
  border-radius: 50%;
  background: radial-gradient(circle, #ff3333, #990000);
  box-shadow: 0 0 30px red;
  z-index: 3;
}
.ddoong {
  width: 65px;
  height: 65px;
  border-radius: 8px;
  background: linear-gradient(45deg, #ff4444, #aa0000);
  box-shadow: 0 0 40px #ff0000;
}

/* ===== ì˜¤ë¸Œ ===== */
.orb {
  position: absolute;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  box-shadow: 0 0 25px;
  z-index: 4;
}
.green {
  background: radial-gradient(circle, #00ff99, #007744);
  box-shadow: 0 0 20px #00ff99;
}
.yellow {
  background: radial-gradient(circle, #ffff88, #ffbb00);
  box-shadow: 0 0 35px #ffcc00;
  animation: pulse 1s infinite alternate;
}
@keyframes pulse {
  from { transform: scale(1); opacity: 0.8; }
  to { transform: scale(1.3); opacity: 1; }
}

/* ===== í•˜ë‹¨ UI ===== */
#controlBox {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 420px;
  height: 160px;
  border: 2px solid white;
  background: rgba(0, 0, 0, 0.8);
  text-align: center;
  padding-top: 10px;
  box-shadow: 0 0 25px #00ffff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
#attackBtn {
  background: #ff3333;
  color: white;
  border: none;
  padding: 10px 25px;
  border-radius: 8px;
  font-family: inherit;
  cursor: pointer;
  font-size: 1rem;
  box-shadow: 0 0 10px red;
  display: none;
  margin-top: 15px;
}
#msg {
  color: #ccc;
  font-size: 0.9rem;
}
#hearts {
  text-align: center;
  margin-top: 10px;
  font-size: 1.3rem;
  color: #ff6666;
}

/* ===== í”¼ê²© / ì»·ì”¬ / í”Œë˜ì‹œ ===== */
.flash {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 0, 0, 0.4);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
}
#cutscene {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: black;
  opacity: 0;
  pointer-events: none;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  font-size: 1.4rem;
  text-shadow: 0 0 20px cyan;
  transition: opacity 1s;
  z-index: 20;
}
</style>
</head>
<body>

<div id="bossArea">
  <img id="boss" src="imboss.jpg" alt="ë™íœ˜">
  <div id="bossHP">ë³´ìŠ¤ HP: 2000</div>
</div>

<div id="battleBox">
  <div id="jinwoo"></div>
</div>

<div id="hearts"></div>

<div id="controlBox">
  <div id="msg">ì „íˆ¬ ì‹œì‘!</div>
  <button id="attackBtn">âš” ê³µê²©í•  ê¸°íšŒë‹¤!</button>
</div>

<div class="flash" id="flash"></div>
<div id="cutscene"></div>

<script>
/* ===== ì§ì—… ëŠ¥ë ¥ì¹˜ ===== */
const jobStats = {
  "ë³µì„œ": { hp: 3, atk: 100 },
  "ì§„í™”í•œìƒŒë“œë°±": { hp: 10, atk: 50 },
  "ë„¤í¬ë¡œë§¨ì„œ": { hp: 8, atk: 100 },
  "ìŠˆí¼ì§„ìš°": { hp: 15, atk: 150 },
  "ê°ì„±ì§„ìš°": { hp: 20, atk: 200 }
};

/* ===== ê¸°ë³¸ ë³€ìˆ˜ ===== */
let job = localStorage.getItem("jinwooJob") || "ìŠˆí¼ì§„ìš°";
let jinwooHP = jobStats[job].hp;
let atkPower = jobStats[job].atk;
let bossHP = 2000;
let invincible = false;
let paused = false;
let ultimateUsed = false;
let turn = "boss";
let jinwooX = 300,
  jinwooY = 150;
let keys = {};
const speed = 3.5;

const box = document.getElementById("battleBox");
const jinwoo = document.getElementById("jinwoo");
const msg = document.getElementById("msg");
const bossHPtxt = document.getElementById("bossHP");
const hearts = document.getElementById("hearts");
const attackBtn = document.getElementById("attackBtn");
const flash = document.getElementById("flash");
const cutscene = document.getElementById("cutscene");

/* ===== ì´ˆê¸° ì„¤ì • ===== */
updateUI();
msg.textContent = `í˜„ì¬ ì§ì—…: ${job} (â¤ï¸${jinwooHP}, âš”ï¸${atkPower})`;
setTimeout(startBossTurn, 3000);
spawnOrbs();

/* ===== ì´ë™ ===== */
document.addEventListener("keydown", (e) => (keys[e.key.toLowerCase()] = true));
document.addEventListener("keyup", (e) => (keys[e.key.toLowerCase()] = false));

function moveLoop() {
  if (!paused && turn === "boss") {
    if (keys["w"]) jinwooY -= speed;
    if (keys["s"]) jinwooY += speed;
    if (keys["a"]) jinwooX -= speed;
    if (keys["d"]) jinwooX += speed;
    jinwooX = Math.max(0, Math.min(610, jinwooX));
    jinwooY = Math.max(0, Math.min(340, jinwooY));
    jinwoo.style.left = jinwooX + "px";
    jinwoo.style.top = jinwooY + "px";
  }
  if (!paused) checkOrbCollisions();
  requestAnimationFrame(moveLoop);
}
moveLoop();

/* ===== ì˜¤ë¸Œ ìƒì„± ===== */
function spawnOrbs() {
  setInterval(() => {
    if (paused) return;

    // ì´ˆë¡ ì˜¤ë¸Œ 30% í™•ë¥ 
    if (Math.random() < 0.3) createOrb("green");

    // ì²´ë ¥ 1ì¼ ë•Œ ë…¸ë€ ì˜¤ë¸Œ 1íšŒ ë“±ì¥
    if (jinwooHP === 1 && !ultimateUsed) {
      ultimateUsed = true;
      setTimeout(() => createOrb("yellow"), 500);
    }
  }, 3000);
}

function createOrb(type) {
  const orb = document.createElement("div");
  orb.className = `orb ${type}`;
  orb.style.left = Math.random() * 620 + "px";
  orb.style.top = Math.random() * 320 + "px";
  box.appendChild(orb);
  setTimeout(() => orb.remove(), 7000);
}

/* ===== ì¶©ëŒ ===== */
function checkOrbCollisions() {
  const orbs = document.querySelectorAll(".orb");
  orbs.forEach((orb) => {
    if (collide(jinwoo, orb)) {
      if (orb.classList.contains("green")) {
        jinwooHP++;
        updateUI();
        orb.remove();
      } else if (orb.classList.contains("yellow")) {
        orb.remove();
        ultimateCutscene();
      }
    }
  });
}

/* ===== ê¶ê·¹ê¸° ì»·ì”¬ ===== */
function ultimateCutscene() {
  paused = true;
  const scene = document.getElementById("cutscene");
  scene.style.opacity = 1;
  scene.textContent = "âš¡ ì§„ìš°ì˜ ê¶ê·¹ê¸° ë°œë™ âš¡";
  jinwoo.style.transition = "all 0.4s ease";
  jinwoo.style.boxShadow = "0 0 100px #ffff00, 0 0 200px #ffaa00";
  jinwoo.style.background = "radial-gradient(circle, #fff777, #ffaa00)";

  // ğŸ’« ê¸ˆë¹› ì…ì ìƒì„± í•¨ìˆ˜
  for (let i = 0; i < 50; i++) {
    const spark = document.createElement("div");
    spark.style.position = "fixed";
    spark.style.width = "6px";
    spark.style.height = "6px";
    spark.style.borderRadius = "50%";
    spark.style.background = "gold";
    spark.style.left = window.innerWidth / 2 + (Math.random() * 200 - 100) + "px";
    spark.style.top = window.innerHeight / 2 + (Math.random() * 200 - 100) + "px";
    spark.style.opacity = "0.9";
    spark.style.boxShadow = "0 0 20px gold";
    spark.style.zIndex = "50";
    document.body.appendChild(spark);
    const dx = (Math.random() - 0.5) * 6;
    const dy = (Math.random() - 0.5) * 6;
    let life = 0;
    const fly = setInterval(() => {
      life++;
      spark.style.left = parseFloat(spark.style.left) + dx + "px";
      spark.style.top = parseFloat(spark.style.top) + dy + "px";
      spark.style.opacity = 1 - life / 50;
      if (life > 50) {
        clearInterval(fly);
        spark.remove();
      }
    }, 20);
  }

  // ğŸ¥ ì¹´ë©”ë¼ í”ë“¤ë¦¼
  document.body.style.animation = "shake 0.5s ease 2";
  const shakeCSS = document.createElement("style");
  shakeCSS.textContent = `
    @keyframes shake {
      0% { transform: translate(0,0); }
      20% { transform: translate(-10px, 5px); }
      40% { transform: translate(8px, -5px); }
      60% { transform: translate(-6px, 8px); }
      80% { transform: translate(5px, -8px); }
      100% { transform: translate(0,0); }
    }`;
  document.head.appendChild(shakeCSS);

  // ğŸ”¥ ë‹¨ê³„ë³„ ì»·ì”¬ ëŒ€ì‚¬
  setTimeout(() => (scene.textContent = "ì§„ìš°ì˜ ì—ë„ˆì§€ê°€ í­ë°œí•œë‹¤..."), 1000);
  setTimeout(() => (scene.textContent = "ì„¸ìƒì´ í”ë“¤ë¦°ë‹¤!!"), 2000);
  setTimeout(() => (scene.textContent = "ë¹›ì˜ íŒŒë™ì´ ë™íœ˜ë¥¼ ë®ì¹œë‹¤! ğŸ’¥"), 3000);

  // ğŸ’¥ ë¶‰ì€ í­ë°œ í”Œë˜ì‹œ
  setTimeout(() => {
    flash.style.background = "rgba(255, 50, 0, 0.5)";
    flash.style.opacity = 1;
  }, 3200);
  setTimeout(() => (flash.style.opacity = 0), 3600);

  setTimeout(() => {
    bossHP -= 300;
    updateUI();
    cutscene.style.opacity = 0;
    paused = false;
    msg.textContent = "ê¶ê·¹ê¸°! ğŸ’¥ 300 ë°ë¯¸ì§€!";
    if (bossHP <= 0) {
      msg.textContent = "ë™íœ˜: ...ë§ë„ ì•ˆë¼...";
      setTimeout(() => (window.location.href = "jinwo24.html"), 2500);
    }
  }, 4000);
}

/* ===== ë³´ìŠ¤ ê³µê²© ===== */
function startBossTurn() {
  turn = "boss";
  msg.textContent = "ë™íœ˜ì˜ ê³µê²©!";
  attackBtn.style.display = "none";
  const pattern = Math.random() < 0.5 ? 1 : 2;
  if (pattern === 1) pattern_Ddoong();
  else pattern_MultiRed();
}

/* ===== ê³µê²© íŒ¨í„´ ===== */
function pattern_Ddoong() {
  if (paused) return;
  const boxRect = box.getBoundingClientRect();
  for (let i = 0; i < 5; i++) {
    setTimeout(() => {
      const atk = document.createElement("div");
      atk.className = "attack ddoong";
      atk.style.left = boxRect.left - 100 + "px";
      atk.style.top = boxRect.top + Math.random() * 300 + "px";
      document.body.appendChild(atk);
      let x = boxRect.left - 100;
      const move = setInterval(() => {
        if (paused) return;
        x += 12;
        atk.style.left = x + "px";
        if (collide(jinwoo, atk) && !invincible) {
          hitPlayer();
          atk.remove();
          clearInterval(move);
        }
        if (x > boxRect.right + 100) {
          atk.remove();
          clearInterval(move);
        }
      }, 40);
    }, i * 400);
  }
  setTimeout(nextTurn, 3000);
}

function pattern_MultiRed() {
  if (paused) return;
  const boxRect = box.getBoundingClientRect();
  for (let i = 0; i < 15; i++) {
    setTimeout(() => {
      const atk = document.createElement("div");
      atk.className = "attack";
      atk.style.left = boxRect.left + Math.random() * 600 + "px";
      atk.style.top = boxRect.top - 80 + "px";
      document.body.appendChild(atk);
      let y = boxRect.top - 80;
      const fall = setInterval(() => {
        if (paused) return;
        y += 8;
        atk.style.top = y + "px";
        if (collide(jinwoo, atk) && !invincible) {
          hitPlayer();
          atk.remove();
          clearInterval(fall);
        }
        if (y > boxRect.bottom + 50) {
          atk.remove();
          clearInterval(fall);
        }
      }, 40);
    }, i * 200);
  }
  setTimeout(nextTurn, 4000);
}

/* ===== í”¼ê²© ===== */
function hitPlayer() {
  if (paused) return;
  jinwooHP--;
  updateUI();
  flash.style.opacity = 1;
  setTimeout(() => (flash.style.opacity = 0), 200);
  if (jinwooHP <= 0) {
    msg.textContent = "ì§„ìš°ëŠ” ì¡Œë‹¤...";
    setTimeout(() => (window.location.href = "index.html"), 2500);
  }
}

/* ===== í„´ ì „í™˜ ===== */
function nextTurn() {
  if (jinwooHP > 0 && bossHP > 0) {
    msg.textContent = "ê³µê²©í•  ê¸°íšŒë‹¤!";
    attackBtn.style.display = "block";
    turn = "player";
  }
}

/* ===== ê³µê²© ë²„íŠ¼ ===== */
attackBtn.addEventListener("click", () => {
  if (turn !== "player") return;
  attackBtn.style.display = "none";
  msg.textContent = `${job}ì˜ ê³µê²©!`;
  bossHP -= atkPower;
  updateUI();
  if (bossHP <= 0) {
    msg.textContent = "ë™íœ˜: ...ë§ë„ ì•ˆë¼...";
    setTimeout(() => (window.location.href = "jinwo24.html"), 2500);
  } else {
    setTimeout(startBossTurn, 1500);
  }
});

/* ===== ì¶©ëŒ íŒì • ===== */
function collide(a, b) {
  const r1 = a.getBoundingClientRect();
  const r2 = b.getBoundingClientRect();
  return !(
    r1.right < r2.left ||
    r1.left > r2.right ||
    r1.bottom < r2.top ||
    r1.top > r2.bottom
  );
}

/* ===== UI ì—…ë°ì´íŠ¸ ===== */
function updateUI() {
  bossHPtxt.textContent = `ë³´ìŠ¤ HP: ${bossHP}`;
  hearts.innerHTML = "â¤ï¸".repeat(jinwooHP);
}
</script>
</body>
</html>
